---
phase: 05-npm-package-publish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [package.json]
autonomous: false

must_haves:
  truths:
    - "npm info lightdash-mcp returns package metadata from npm registry"
    - "package.json contains bin, files, engines, keywords, repository, and license fields with no private field"
    - "build/index.js starts with #!/usr/bin/env node shebang"
    - "npx -y lightdash-mcp downloads and starts the server process"
  artifacts:
    - path: "package.json"
      provides: "npm package metadata"
      contains: "engines"
    - path: "build/index.js"
      provides: "Executable entry point"
      contains: "#!/usr/bin/env node"
  key_links:
    - from: "package.json bin field"
      to: "build/index.js"
      via: "bin entry lightdash-mcp -> ./build/index.js"
      pattern: '"lightdash-mcp":\\s*"\\./build/index\\.js"'
---

<objective>
Add the missing `engines` field to package.json, rebuild, and publish to npm as `lightdash-mcp`.

Purpose: Make the MCP server installable via `npx -y lightdash-mcp` so users do not need to clone the repo.
Output: Live npm package at https://www.npmjs.com/package/lightdash-mcp
</objective>

<execution_context>
@/Users/mikhailgasanov/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mikhailgasanov/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@package.json
@tsconfig.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add engines field and rebuild</name>
  <files>package.json</files>
  <action>
Add the `engines` field to package.json specifying Node.js >= 18 (minimum for built-in fetch and stable ESM support used by this project). Place it after the `devDependencies` block:

```json
"engines": {
  "node": ">=18"
}
```

Then run `npm run build` to ensure a fresh build with the shebang intact. After build, verify:
1. `build/index.js` first line is `#!/usr/bin/env node`
2. `npm pack --dry-run` shows the expected files (build/*.js, LICENSE, README.md, package.json)
3. No `"private"` field exists in package.json

Do NOT change any other fields -- bin, files, keywords, repository, license, author, homepage, bugs are already correct.
  </action>
  <verify>
Run: `node -e "const p = require('./package.json'); console.log('engines:', p.engines, 'private:', p.private, 'bin:', p.bin)"` — should show engines: { node: '>=18' }, private: undefined, bin: { 'lightdash-mcp': './build/index.js' }.
Run: `head -1 build/index.js` — should show `#!/usr/bin/env node`.
Run: `npm pack --dry-run 2>&1 | grep 'total files'` — should show 16 files.
  </verify>
  <done>package.json has engines field with node >=18, no private field, build/index.js has shebang, npm pack preview is correct.</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: npm login</name>
  <action>
The user must authenticate to npm before publishing. `npm whoami` currently returns ENEEDAUTH.

Run in your terminal:
```bash
npm login
```

This will open a browser for npm authentication or prompt for username/password/OTP. Claude cannot perform this step because it requires interactive browser-based authentication.
  </action>
  <how-to-verify>
After logging in, run: `npm whoami` — it should print your npm username.
  </how-to-verify>
  <resume-signal>Type "logged in" when `npm whoami` shows your username.</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Publish to npm and verify</name>
  <files></files>
  <action>
Run `npm publish --access public` from the source repo `/Users/mikhailgasanov/Documents/Lightdash MCP/`.

The `--access public` flag is required because scoped/unscoped packages default differently; this ensures the package is publicly visible.

After publish succeeds, verify:
1. `npm info lightdash-mcp` returns package metadata (name, version, description)
2. `npm info lightdash-mcp version` returns "1.0.0"
3. `npm info lightdash-mcp bin` shows the lightdash-mcp binary

Do NOT run `npx -y lightdash-mcp` to test — it will start a server that hangs waiting for stdin (the MCP stdio transport). The npm info checks are sufficient to confirm the package is live and installable.
  </action>
  <verify>
Run: `npm info lightdash-mcp name` — should return "lightdash-mcp".
Run: `npm info lightdash-mcp version` — should return "1.0.0".
Run: `npm info lightdash-mcp bin` — should show { 'lightdash-mcp': 'build/index.js' }.
  </verify>
  <done>Package lightdash-mcp@1.0.0 is live on npm registry. `npm info lightdash-mcp` returns correct metadata.</done>
</task>

</tasks>

<verification>
1. `npm info lightdash-mcp` returns package metadata (not 404)
2. package.json contains: bin, files, engines, keywords, repository, license — no "private" field
3. `head -1 build/index.js` shows `#!/usr/bin/env node`
4. Package is downloadable: `npm pack lightdash-mcp` fetches the published tarball
</verification>

<success_criteria>
- `npm info lightdash-mcp` returns metadata from the npm registry
- package.json has all required fields (bin, files, engines, keywords, repository, license) with no "private" field
- build/index.js starts with `#!/usr/bin/env node` shebang
- Package is installable from npm (confirmed via npm info, not npx which would hang)
</success_criteria>

<output>
After completion, create `.planning/phases/05-npm-package-publish/05-01-SUMMARY.md`
</output>
